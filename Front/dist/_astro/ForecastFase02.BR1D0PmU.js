import{j as s}from"./jsx-runtime.CLpGMVip.js";import{r as u}from"./index.BL7xzsR_.js";import{F as w,a as z}from"./ForecastHeader.B-JzKqdt.js";function l({initialValue:e,onChange:a}){const[t,o]=u.useState(!1),[n,r]=u.useState(e);function f(){o(!1),a(n)}return t?s.jsx("input",{autoFocus:!0,value:n,onChange:p=>r(p.target.value),onBlur:f,className:"border w-full border-red-500 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-red-300"}):s.jsx("div",{onClick:()=>o(!0),className:"cursor-pointer",children:n})}const K=[{accessorKey:"cliente_t2",header:"Cliente T2",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"cliente_t2",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"estoque_t2",header:"Estoque T2",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"estoque_t2",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"em_transito_dist",header:"Em transito Dist",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"em_transito_dist",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"total_estoque_t2",header:"Total estoque T2",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"total_estoque_t2",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"media_vendas_13w",header:"Media Vendas 13W",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"media_vendas_13w",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"woh_t2",header:"WOH T2",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"woh_t2",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"fcst_frozen_si",header:"Fcst Frozen SI",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"fcst_frozen_si",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"realizado_si",header:"Realizado SI",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"realizado_si",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"pct_fcst_si",header:"% Fcst SI",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"pct_fcst_si",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"realizado_si_ly",header:"Realizado SI LY",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"realizado_si_ly",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"pct_yoy",header:"% YoY",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"pct_yoy",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"fcst_frozen_so",header:"Fcst Frozen SO",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"fcst_frozen_so",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"realizado_so",header:"Realizado SO",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"realizado_so",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"pct_fcst_so",header:"% Fcst SO",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"pct_fcst_so",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"realizado_so_ly",header:"Realizado SO LY",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"realizado_so_ly",r)};return s.jsx(l,{initialValue:o,onChange:n})}},{accessorKey:"pct_yoy_so",header:"% YoY",enableSorting:!0,cell:({row:e,getValue:a,table:t})=>{const o=a(),n=r=>{t.options.meta?.updateData(e.index,"pct_yoy_so",r)};return s.jsx(l,{initialValue:o,onChange:n})}}];function F(){const e=u.useRef(null),a=u.useRef(null),[t,o]=u.useState(0),[n,r]=u.useState([]),[f,p]=u.useState([]);u.useEffect(()=>{a.current&&o(a.current.offsetWidth)},[]),u.useEffect(()=>{y().then(i=>{if(!i||!i.columns||!i.rows){console.error("Erro: resposta da API não tem colunas ou linhas",i);return}console.log("Dados brutos recebidos da API:",i);const c=b(i.columns);console.log("mergedCols",c);const d=C(i.rows,c);r(c),p(d)}).catch(i=>console.error("Erro ao carregar dados do servidor:",i))},[]);const y=async()=>{const i=localStorage.getItem("token");try{const c=await fetch("https://api.logihub.space/api/forecast-data",{headers:{Authorization:`Bearer ${i}`}});if(!c.ok)throw new Error(`Erro na API: ${c.statusText}`);return await c.json()}catch(c){return console.error("Erro ao buscar dados do servidor:",c),{columns:[],rows:[]}}},b=i=>{if(!i||!Array.isArray(i))return console.error("Erro: serverCols inválido",i),[];const c=i.map(d=>{const x=d.key.trim().toLowerCase(),m=K.find(g=>g.accessorKey.trim().toLowerCase()===x);return m?{...m,header:d.name||m.header}:{accessorKey:d.key,header:d.name||d.key}});return console.log("Colunas mescladas (verifique os nomes):",c),c},C=(i,c)=>i.map((d,x)=>{let m={id:d.id||x+1};return c.forEach(({accessorKey:g})=>{const D=g.trim().toLowerCase(),_=Object.keys(d).find(h=>h.trim().toLowerCase()===D);if(_){let h=d[_];!isNaN(h)&&h!==null&&h!==""&&(h=Number(h)),m[g]=h}else m[g]=null}),m});function S(){e.current&&t>0&&e.current.scrollBy({left:-t,behavior:"smooth"})}function j(){e.current&&t>0&&e.current.scrollBy({left:t,behavior:"smooth"})}return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"p-5 mt-5 bg-[#1f2937] border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-6 dark:bg-gray-800",children:s.jsx(w,{dataState:f,setDataState:p})}),s.jsxs("div",{className:"p-5 mt-5 bg-[#1f2937] border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-6 dark:bg-gray-800",children:[s.jsxs("div",{className:"flex flex-row",children:[s.jsx("button",{onClick:S,className:"text-white py-2 px-5 border border-white rounded-md mr-5 my-5",children:"<<< "}),s.jsx("button",{onClick:j,className:"text-white py-2 px-5 border border-white rounded-md mr-5 my-5",children:">>> "})]}),s.jsx(z,{ref:a,cardTitle:"Snapshot do trimestre atual",initialData:f,columns:n})]})]})}export{F as default};
